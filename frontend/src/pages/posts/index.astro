---
import Container from "@/layouts/Container.astro";
import BaseLayout from "@/layouts/BaseLayout.astro";
import { wpFetch } from "@/lib/wp";
import FeaturedPosts from "@/components/Posts/FeaturedPosts.astro";
import RegularPosts from "@/components/Posts/RegularPosts.astro";

// 15 последних постов
const posts: any[] = await wpFetch(
  `/wp/v2/posts?per_page=100&orderby=date&order=desc&_fields=id,slug,date,link,title,excerpt,acf`
);

const slugOf = (p: any) => p.slug ?? p.link?.split("/").filter(Boolean).pop();
const imgOf = (p: any) =>
  p?.acf?.seo?.seo_image || "/images/news-placeholder.jpg";
const fmt = (iso: string) =>
  new Date(iso).toLocaleDateString("ru-RU", {
    day: "2-digit",
    month: "long",
    year: "numeric",
  });

const [featured, ...rest] = posts;
const highlights = rest.slice(0, 2);
const masonry = rest.slice(2);
---

<BaseLayout
  title="Новости"
  description="Аренда оборудования для праздников в Гродно — свежие новости и статьи"
>
  <Container big class:list="mt-32 mb-20 space-y-10">
    <!-- Витрина -->
    {
      featured && (
        <FeaturedPosts {slugOf} {imgOf} {fmt} {featured} {highlights} />
      )
    }

    <!-- Masonry-лента -->
    <RegularPosts {slugOf} {imgOf} {fmt} {masonry} />
  </Container>
</BaseLayout>
