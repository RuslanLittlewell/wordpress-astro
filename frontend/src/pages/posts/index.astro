---
import BaseLayout from "@/layouts/BaseLayout.astro";
import Container from "@/layouts/Container.astro";
import { wpFetch } from "@/lib/wp";

let posts;
try {
  posts = await wpFetch(`/wp/v2/posts?_fields=id,title,excerpt,slug,date,acf`);
} catch (error) {
  console.warn('Не удалось получить посты из WordPress API');
  posts = [
    {
      id: 1,
      title: { rendered: 'Пост по умолчанию' },
      excerpt: { rendered: 'Описание поста' },
      slug: 'default',
      date: new Date().toISOString(),
      acf: { image: '' }
    }
  ];
}
---

<BaseLayout title="Новости">
  <Container class:list="mt-32 mb-16 bg-zinc-50">
    <h1 class="mb-8 text-4xl font-bold">Новости</h1>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {posts.map((post: any) => (
        <article class="bg-white rounded-lg shadow-md overflow-hidden">
          <div class="p-6">
            <h2 class="text-xl font-semibold mb-2" set:html={post.title.rendered} />
            <p class="text-gray-600 mb-4" set:html={post.excerpt.rendered} />
            <a href={`/posts/${post.slug}`} class="text-blue-600 hover:underline">
              Читать далее
            </a>
          </div>
        </article>
      ))}
    </div>
  </Container>
</BaseLayout>
