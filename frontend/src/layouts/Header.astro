---
import Container from "./Container.astro";
import { CallbackButton } from "@/components/MainPage/features/Callback";
import LogoImg from "@/assets/svg/logo.svg";
import MobileMenu from "@/components/shared/MobileMenu";

const links = [
  { href: "/", label: "Главная" },
  { href: "/catalog", label: "Каталог" },
  { href: "/terms", label: "Условия" },
  { href: "/posts", label: "Новости" },
  { href: "/contacts", label: "Контакты" },
];
const { data } = Astro.props;

// helper: активен ли линк (включая вложенные маршруты)
const path = Astro.url.pathname.replace(/\/+$/, "") || "/";
const isActive = (href: string) => {
  const clean = (href || "/").replace(/\/+$/, "") || "/";
  return path === clean || (clean !== "/" && path.startsWith(clean));
};
---

<header class="fixed top-0 z-50 w-full bg-main-gradient shadow-md">
  <Container class:list="w-full flex items-center justify-between p-1 md:p-4">
    <div class="flex items-center gap-1 md:gap-4">
      <div class="logo">
        <LogoImg />
      </div>
      <div class="text-[8px] md:text-xs flex flex-col text-white">
        <span>{data.address}</span>
        <span
          ><span class="hidden sm:inline-block">Время работы:</span>
          {data.work_time}</span
        >
      </div>
      <div class="hidden md:inline-block md:text-md lg:text-lg">
        <a href={`tel:${data.phone}`} class="text-white font-bold"
          >{data.phone}</a
        >
      </div>
    </div>

    <div class="hidden items-center gap-6 lg:flex">
      <nav>
        <ul class="flex items-center gap-2 md:gap-2 lg:gap-3 pb-2 text-white">
          {
            links.map((link) => (
              <li>
                <a
                  href={link.href}
                  aria-current={isActive(link.href) ? "page" : undefined}
                  class:list={["inline-block whitespace-nowrap relative"]}
                >
                  {link.label}
                  {isActive(link.href) && (
                    <span class="absolute h-[1px] block rounded-full w-full bg-white bottom-[-5px] " />
                  )}
                </a>
              </li>
            ))
          }
        </ul>
      </nav>
      <CallbackButton client:load url="http://13.61.2.249/wp-json/" />
    </div>
    <MobileMenu {links} {data} client:load />
  </Container>
</header>
